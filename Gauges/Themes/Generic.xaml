<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:Gauges">

  <Style TargetType="{x:Type local:Gauge}">
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type local:Gauge}">
          <ControlTemplate.Resources>
            <Style x:Key="LabelStyle" TargetType="{x:Type TextBlock}">
              <Setter Property="VerticalAlignment" Value="Top" />
              <Setter Property="HorizontalAlignment" Value="Center" />
              <Setter Property="Grid.Row" Value="0" />
            </Style>
            <LinearGradientBrush x:Key="Brush" StartPoint="0,0" EndPoint="1,0">
              <LinearGradientBrush.GradientStops>
                <GradientStopCollection>
                  <GradientStop Offset="0.0" Color="Red" />
                  <GradientStop Offset="0.25" Color="Red" />
                  <GradientStop Offset="0.25" Color="Green" />
                  <GradientStop Offset="0.75" Color="Green" />
                  <GradientStop Offset="0.75" Color="Red" />
                  <GradientStop Offset="1.0" Color="Red" />
                </GradientStopCollection>
              </LinearGradientBrush.GradientStops>
            </LinearGradientBrush>

            <DataTemplate x:Key="CircleTemplate">
              <Rectangle Width="3" Height="10" VerticalAlignment="Bottom"
                         Fill="{Binding Foreground,
                                        RelativeSource={RelativeSource Mode=FindAncestor,
                                                                       AncestorType={x:Type local:Gauge}}}" />
            </DataTemplate>
            <DataTemplate x:Key="RectangleTemplate" />
            <DataTemplate x:Key="TriangleTemplate" />
            <DataTemplate x:Key="LineTemplate" />
            <local:GaugeIndicatorConverter x:Key="GaugeShapeConverter"
                                           Circle="{StaticResource CircleTemplate}"
                                           Line="{StaticResource LineTemplate}"
                                           Rectangle="{StaticResource RectangleTemplate}"
                                           Triangle="{StaticResource TriangleTemplate}" />

            <local:MakerDataTemplateSelector x:Key="MarkerDataTemplateSelector"
                                             Circle="{StaticResource CircleTemplate}"
                                             Line="{StaticResource LineTemplate}"
                                             Rectangle="{StaticResource RectangleTemplate}"
                                             Triangle="{StaticResource TriangleTemplate}" />


          </ControlTemplate.Resources>
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="30" />
              <RowDefinition x:Name="BottomRow" Height="Auto"
                             MinHeight="{TemplateBinding MinHeight}" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Grid.ColumnSpan="2"
                       Style="{StaticResource LabelStyle}"
                       Text="{Binding Minimum,
                                      RelativeSource={RelativeSource TemplatedParent},
                                      StringFormat='{}{0:F0}'}" />
            <TextBlock Grid.Column="3" Grid.ColumnSpan="2"
                       Style="{StaticResource LabelStyle}"
                       Text="{Binding Maximum,
                                      RelativeSource={RelativeSource TemplatedParent},
                                      StringFormat='{}{0:F0}'}" />

            <Grid Grid.Row="0" Grid.RowSpan="2" Grid.Column="1" Grid.ColumnSpan="3">
              <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="{Binding ElementName=BottomRow, Path=ActualHeight}" />
              </Grid.RowDefinitions>
              <Border x:Name="PART_Track" Grid.Row="1" Height="8" VerticalAlignment="Center"
                      BorderBrush="{StaticResource Brush}"
                      BorderThickness="2" CornerRadius="2" />
              <!--
                <local:TextTickBar Grid.Row="0"
                Ticks="25, 50, 75"
                SnapsToDevicePixels="True"
                VerticalAlignment="Bottom" Placement="Top" Height="20"
                Visibility="Visible" Fill="{StaticResource Brush}"/>
              -->
              <TickBar x:Name="TopTick" Grid.Row="1" Width="200" Height="20"
                       VerticalAlignment="Bottom"
                       Fill="{StaticResource Brush}"
                       Placement="Top" SnapsToDevicePixels="True" TickFrequency="25" Visibility="Visible" />
              <Grid x:Name="PART_Indicator" Grid.Row="0" Grid.RowSpan="2" VerticalAlignment="Stretch">
                <TextBlock Background="White"
                           Style="{StaticResource LabelStyle}"
                           Text="{Binding Value,
                                          RelativeSource={RelativeSource TemplatedParent},
                                          StringFormat='{}{0:F0}'}" />

                <ContentPresenter ContentTemplateSelector="{StaticResource MarkerDataTemplateSelector}" />
                <!--
                  <Rectangle Width="3"
                  Height="10"
                  VerticalAlignment="Bottom"
                  Fill="{TemplateBinding Foreground}" />
                -->
              </Grid>
            </Grid>

          </Grid>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>



</ResourceDictionary>
